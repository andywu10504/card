<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>抽卡小工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 + jQuery -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background: #f7f7f9;
    }

    /* 牌圖區塊：盡量放大、不變形 */
    .card-preview {
      width: 100%;
      height: calc(100vh - 220px); /* 留一點空間給上方選單和下方按鈕 */
      max-height: 700px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #card-img {
      max-width: 100%;
      max-height: 100%;
      border-radius: .5rem;
      border: 3px solid #343a40;
      background: #e9ecef;
      object-fit: contain;
      display: block;
    }
  </style>
</head>
<body>
<div class="container py-3">

  <!-- 第一行：選擇牌組 -->
  <div class="mb-3">
    <label for="deckSelect" class="form-label mb-1">選擇牌組</label>
    <select id="deckSelect" class="form-select">
      <!-- 由 JS 動態填入 -->
    </select>
  </div>

  <!-- 第二行：牌圖（只有圖） -->
  <div class="mb-3">
    <div class="card-preview">
      <img id="card-img" src="" alt="">
    </div>
  </div>

  <!-- 第三行：抽卡按鈕 -->
  <div class="mb-2">
    <div class="d-grid">
      <button id="btnDraw" class="btn btn-primary btn-lg">
        開始抽卡
      </button>
    </div>
  </div>

</div>

<script>
  // ============================================
  // 1. 這裡設定你的牌組（依你的資料夾調整）
  // ============================================
  const DECKS = {
    "deck_114_people": {
      label: "114國學營 - 人物牌組",
      path: "./decks/114國學營_人物/",
      cards: [
        "投影片1.PNG",
        "投影片2.PNG",
        "投影片3.PNG",
        "投影片4.PNG",
        "投影片5.PNG",
        "投影片6.PNG",
        "投影片7.PNG",
        "投影片8.PNG",
        "投影片9.PNG",
        "投影片10.PNG",
        "投影片11.PNG",
        "投影片12.PNG"
      ]
    },
    "deck_tarot": {
      label: "Tarot 塔羅牌（示意）",
      path: "./decks/Tarot/",
      cards: [
        "card01.jpg",
        "card02.jpg",
        "card03.jpg"
      ]
    }
    // 之後要新增牌組就照這個格式往下加
  };

  // ============================================
  // 2. 初始化下拉選單
  // ============================================
  function initDeckSelect() {
    const $sel = $("#deckSelect");
    $sel.empty();

    $sel.append(`<option value="">請選擇牌組</option>`);

    Object.keys(DECKS).forEach(key => {
      const deck = DECKS[key];
      $sel.append(
        `<option value="${key}">${deck.label}</option>`
      );
    });
  }

  // ============================================
  // 3. 抽卡邏輯：轉動一段時間後停下
  // ============================================
  let spinning = false;
  let spinTimer = null;

  function randomPick(arr) {
    const idx = Math.floor(Math.random() * arr.length);
    return { idx, value: arr[idx] };
  }

  function showCard(deckKey, cardFileName) {
    const deck = DECKS[deckKey];
    if (!deck) return;

    const imgPath = deck.path + cardFileName;
    $("#card-img")
      .attr("src", imgPath)
      .attr("alt", cardFileName);
  }

  function startSpin() {
    const deckKey = $("#deckSelect").val();
    if (!deckKey) {
      alert("請先選擇牌組！");
      return;
    }

    const deck = DECKS[deckKey];
    if (!deck || !Array.isArray(deck.cards) || deck.cards.length === 0) {
      alert("這個牌組沒有卡片，請檢查設定與檔案。");
      return;
    }

    if (spinning) {
      return;
    }

    spinning = true;
    const $btn = $("#btnDraw");
    $btn.prop("disabled", true).text("抽牌中…");

    // 轉動時不斷隨機切換
    spinTimer = setInterval(() => {
      const pick = randomPick(deck.cards);
      showCard(deckKey, pick.value);
    }, 80); // 每 80ms 換一張

    // 隨機設定轉動時間（例如 1.5～2.5 秒）
    const duration = 1500 + Math.random() * 1000;

    setTimeout(() => {
      clearInterval(spinTimer);
      spinTimer = null;

      const finalPick = randomPick(deck.cards);
      showCard(deckKey, finalPick.value);

      spinning = false;
      $btn.prop("disabled", false).text("開始抽卡");
    }, duration);
  }

  // ============================================
  // 4. 綁定事件 & 初始化
  // ============================================
  $(function () {
    initDeckSelect();

    $("#btnDraw").on("click", function () {
      startSpin();
    });
  });
</script>

</body>
</html>
