<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>抽卡小工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 + jQuery -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background: #f7f7f9;
    }
    .card-preview {
      max-width: 320px;
      margin: 0 auto;
    }
    #card-img {
      width: 100%;
      height: auto;
      border-radius: .5rem;
      border: 3px solid #343a40;
      background: #e9ecef;
      object-fit: contain;
    }
    .spin-status {
      min-height: 1.5rem;
    }
  </style>
</head>
<body>
<div class="container py-4">

  <div class="text-center mb-4">
    <h1 class="h3 fw-bold mb-1">抽卡小工具</h1>
    <p class="text-muted mb-0">選擇牌組 → 按下「開始抽卡」→ 轉一轉後停下來</p>
  </div>

  <!-- 控制區 -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-md-6">
          <label for="deckSelect" class="form-label mb-1">選擇牌組</label>
          <select id="deckSelect" class="form-select">
            <!-- 由 JS 動態填入 -->
          </select>
        </div>
        <div class="col-md-6 text-md-end text-center">
          <button id="btnDraw" class="btn btn-primary me-2">
            開始抽卡
          </button>
          <button id="btnReset" class="btn btn-outline-secondary">
            清空顯示
          </button>
        </div>
      </div>
      <div class="mt-3 text-muted small">
        若沒反應：請確認牌組路徑與檔名是否正確、圖片有放到對應資料夾。
      </div>
    </div>
  </div>

  <!-- 顯示區 -->
  <div class="card shadow-sm">
    <div class="card-body text-center">
      <div class="spin-status mb-2">
        <span id="spinStatus" class="text-secondary">尚未抽卡</span>
      </div>

      <div class="card-preview mb-3">
        <img id="card-img" src="" alt="抽出的卡片會顯示在這裡">
      </div>

      <div class="fw-bold fs-5" id="card-name">（卡片名稱）</div>
      <div class="text-muted small" id="deck-name">（牌組名稱）</div>
    </div>
  </div>

</div>

<script>
  // ============================================
  // 1. 這裡設定你的牌組（依你的資料夾調整）
  // ============================================
  // key: 內部代號
  // label: 下拉式選單顯示的文字
  // path: 此牌組的資料夾路徑（相對於 index.html）
  // cards: 該資料夾內的圖片檔名（jpg / png 皆可）
  const DECKS = {
    "deck_114_people": {
      label: "114國學營 - 人物牌組",
      path: "./decks/114國學營_人物/",
      cards: [
        "投影片1.PNG",
        "投影片2.PNG",
        "投影片3.PNG",
        "投影片4.PNG",
        "投影片5.PNG",
        "投影片6.PNG",
        "投影片7.PNG",
        "投影片8.PNG",
        "投影片9.PNG",
        "投影片10.PNG",
        "投影片11.PNG",
        "投影片12.PNG"
      ]
    },
    "deck_tarot": {
      label: "Tarot 塔羅牌（示意）",
      path: "./decks/Tarot/",
      cards: [
        "card01.jpg",
        "card02.jpg",
        "card03.jpg"
      ]
    }
    // 之後要新增牌組就照這個格式往下加
  };

  // ============================================
  // 2. 初始化下拉選單
  // ============================================
  function initDeckSelect() {
    const $sel = $("#deckSelect");
    $sel.empty();

    // 加一個請選擇
    $sel.append(`<option value="">請選擇牌組</option>`);

    // 從 DECKS 填入
    Object.keys(DECKS).forEach(key => {
      const deck = DECKS[key];
      $sel.append(
        `<option value="${key}">${deck.label}</option>`
      );
    });
  }

  // ============================================
  // 3. 抽卡邏輯：轉動一段時間後停下
  // ============================================
  let spinning = false;
  let spinTimer = null;

  function randomPick(arr) {
    const idx = Math.floor(Math.random() * arr.length);
    return { idx, value: arr[idx] };
  }

  function showCard(deckKey, cardFileName) {
    const deck = DECKS[deckKey];
    if (!deck) return;

    const imgPath = deck.path + cardFileName;
    $("#card-img")
      .attr("src", imgPath)
      .attr("alt", cardFileName);

    // 顯示檔名（去掉副檔名）當卡片名稱
    const nameWithoutExt = cardFileName.replace(/\.[^.]+$/, "");
    $("#card-name").text(nameWithoutExt || "（未命名卡片）");
    $("#deck-name").text(deck.label);
  }

  function startSpin() {
    const deckKey = $("#deckSelect").val();
    if (!deckKey) {
      alert("請先選擇牌組！");
      return;
    }

    const deck = DECKS[deckKey];
    if (!deck || !Array.isArray(deck.cards) || deck.cards.length === 0) {
      alert("這個牌組沒有卡片，請檢查設定與檔案。");
      return;
    }

    if (spinning) {
      // 避免重複按
      return;
    }

    spinning = true;
    $("#spinStatus").text("抽牌中，請稍候…");

    // 轉動時不斷隨機切換
    spinTimer = setInterval(() => {
      const pick = randomPick(deck.cards);
      showCard(deckKey, pick.value);
    }, 80); // 每 80ms 換一張，轉起來

    // 隨機設定轉動時間（例如 1.5～2.5 秒）
    const duration = 1500 + Math.random() * 1000;

    setTimeout(() => {
      // 停止轉動
      clearInterval(spinTimer);
      spinTimer = null;

      const finalPick = randomPick(deck.cards);
      showCard(deckKey, finalPick.value);
      $("#spinStatus").text("抽牌完成！");
      spinning = false;
    }, duration);
  }

  function resetDisplay() {
    if (spinning) return; // 轉動中就不要清除

    $("#card-img").attr("src", "").attr("alt", "");
    $("#card-name").text("（卡片名稱）");
    $("#deck-name").text("（牌組名稱）");
    $("#spinStatus").text("尚未抽卡");
  }

  // ============================================
  // 4. 綁定事件 & 初始化
  // ============================================
  $(function () {
    initDeckSelect();

    $("#btnDraw").on("click", function () {
      startSpin();
    });

    $("#btnReset").on("click", function () {
      resetDisplay();
    });
  });
</script>

</body>
</html>
